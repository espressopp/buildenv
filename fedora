FROM fedora:latest
ENV DEBIAN_FRONTEND noninteractive
RUN dnf makecache
RUN dnf install -y make cmake wget git gcc-c++ doxygen python-devel \
    openmpi-devel environment-modules python-pip clang llvm compiler-rt \
    ccache findutils boost-devel boost-python3-devel python-sphinx fftw-devel \
    python-matplotlib texlive-latex-bin graphviz boost-openmpi-devel \
    ghostscript python3-mpi4py-openmpi texlive-hyphen-base texlive-cm texlive-cmap \
    texlive-ucs texlive-ec gromacs-devel hwloc-devel lmfit-devel ocl-icd-devel hdf5-devel python-h5py atlas hdf5 liblzf \
    python-six python-nose python-numpy sudo
RUN wget -O /usr/bin/doxy-coverage https://raw.githubusercontent.com/alobbs/doxy-coverage/master/doxy-coverage.py
RUN chmod +x /usr/bin/doxy-coverage

RUN useradd -m -G wheel espressopp
RUN echo '%wheel ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers
USER espressopp
ENV PATH=/usr/lib64/ccache:${PATH}${PATH:+:}/usr/lib64/openmpi/bin/
ENV PYTHONPATH=/usr/lib64/python3.8/site-packages/openmpi${PYTHONPATH:+:}${PYTHONPATH}
WORKDIR /home/espressopp
RUN pip install --user codecov coverxygen
